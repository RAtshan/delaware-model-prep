target_default: 9_collaborator_data

packages:
  - sf
  - tidyverse
  - lwgeom
  - smoothr
  - igraph
  - purrr
  - geojsonio
  - geojsonsf
  - ggplot2

sources:
  - 1_network/src/calc_distance_functions.R
  - 1_network/src/geo_fabric_functions.R
  - 2_observations/src/data_munge_functions.R
  - 9_collaborator_data/src/makerspace_geojson.R

targets:
  9_collaborator_data:
    depends:
     #- 9_collaborator_data/out/delaware_sites_summary.geojson.ind
     #- 9_collaborator_data/out/network_subset.rds.ind
     #- 9_collaborator_data/out/distance_matrix.npz.ind
     #- 9_collaborator_data/out/distance_matrix_subset.npz.ind
     
  ##### Makerspace ##### 
  # generate file to load for map (http://delaware-basin-test-website.s3-website-us-west-2.amazonaws.com/)
  
  9_collaborator_data/out/delaware_sites_summary.rds.ind:
    command: generate_site_summary(
      out_ind = target_name, 
      dat_ind = '2_observations/out/basin_temp_data.rds.ind', 
      crosswalk_ind = '2_observations/out/crosswalk_site_reach.rds.ind')
   
  9_collaborator_data/out/delaware_sites_summary.rds:
    command: gd_get('9_collaborator_data/out/delaware_sites_summary.rds.ind')

  # convert summary to geojson

  9_collaborator_data/out/delaware_sites_summary.geojson.ind:
    command: generate_site_geojson(summary_ind = '9_collaborator_data/out/delaware_sites_summary.rds.ind', out_ind = target_name)
      
  9_collaborator_data/out/delaware_sites_summary.geojson:
    command: gd_get('9_collaborator_data/out/delaware_sites_summary.geojson.ind')

  ###### University of Minnesota #####
  # also should include:
    # 1_network/out/network.rds
    # 2_observations/out/basin_temp_data.rds
    
  # npy version of distance matrix
  9_collaborator_data/out/distance_matrix.npz.ind:
    command: save_dist_matrices(dist_mat_ind = '1_network/out/distance_matrix.rds.ind', out_ind = target_name)
   
  9_collaborator_data/out/distance_matrix.npz:
    command: gd_get('9_collaborator_data/out/distance_matrix.npz.ind')
    
  9_collaborator_data/out/network_subset.rds.ind:
    command: make_subnetwork(
      out_ind = target_name,
      lower_reach = I('2748_1'), 
      network_ind = '1_network/out/network.rds.ind', 
      distance_ind = '1_network/out/distance_matrix.rds.ind',
      summary_ind = '9_collaborator_data/out/delaware_sites_summary.rds.ind')
      
  9_collaborator_data/out/network_subset.rds:
    command: gd_get('9_collaborator_data/out/network_subset.rds.ind')
    
  # create distance matrix of subset
  9_collaborator_data/out/distance_matrix_subset.rds.ind:
    command: calc_dist_matrices(network_ind = '9_collaborator_data/out/network_subset.rds.ind', out_ind = target_name)
   
  9_collaborator_data/out/distance_matrix_subset.rds:
    command: gd_get('9_collaborator_data/out/distance_matrix_subset.rds.ind')
    
    # npy version of distance matrix_subset
  9_collaborator_data/out/distance_matrix_subset.npz.ind:
    command: save_dist_matrices(dist_mat_ind = '9_collaborator_data/out/distance_matrix_subset.rds.ind', out_ind = target_name)
   
  9_collaborator_data/out/distance_matrix_subset.npz:
    command: gd_get('9_collaborator_data/out/distance_matrix_subset.npz.ind')