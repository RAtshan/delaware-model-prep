# Do not edit - automatically generated
# from the task_makefile.mustache template
# by create_task_makefile() via create_nhd_HR_download_makefile()
# using scipiper package version 0.0.16

target_default: 1_crosswalk_fetch_nhd_tasks

include:
  - 1_crosswalk_fetch.yml

packages:
  - dplyr
  - sf
  - lwgeom

sources:
  - 1_crosswalk_fetch/src/fetch_NHD.R

file_extensions:
  - "ind"

targets:
  1_crosswalk_fetch_nhd_tasks:
    depends:
      - canonical_lakes_sf.rds.ind_promise
      - gnisname_nhdhr_xwalk.rds.ind_promise

  # --- North_Dakota --- #
  
  NHDHR_North_Dakota_sf:
    command: fetch_NHD_as_sf(url = I('ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Hydrography/NHD/State/HighResolution/GDB/NHD_H_North_Dakota_State_GDB.zip'))

  NHDHR_North_Dakota_filtered_sf:
    command: filter_sf_lakes(NHDHR_North_Dakota_sf, min_size = 40000)

  # --- South_Dakota --- #
  
  NHDHR_South_Dakota_sf:
    command: fetch_NHD_as_sf(url = I('ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Hydrography/NHD/State/HighResolution/GDB/NHD_H_South_Dakota_State_GDB.zip'))

  NHDHR_South_Dakota_filtered_sf:
    command: filter_sf_lakes(NHDHR_South_Dakota_sf, min_size = 40000)

  # --- Iowa --- #
  
  NHDHR_Iowa_sf:
    command: fetch_NHD_as_sf(url = I('ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Hydrography/NHD/State/HighResolution/GDB/NHD_H_Iowa_State_GDB.zip'))

  NHDHR_Iowa_filtered_sf:
    command: filter_sf_lakes(NHDHR_Iowa_sf, min_size = 40000)

  # --- Michigan --- #
  
  NHDHR_Michigan_sf:
    command: fetch_NHD_as_sf(url = I('ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Hydrography/NHD/State/HighResolution/GDB/NHD_H_Michigan_State_GDB.zip'))

  NHDHR_Michigan_filtered_sf:
    command: filter_sf_lakes(NHDHR_Michigan_sf, min_size = 40000)

  # --- Indiana --- #
  
  NHDHR_Indiana_sf:
    command: fetch_NHD_as_sf(url = I('ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Hydrography/NHD/State/HighResolution/GDB/NHD_H_Indiana_State_GDB.zip'))

  NHDHR_Indiana_filtered_sf:
    command: filter_sf_lakes(NHDHR_Indiana_sf, min_size = 40000)

  # --- Illinois --- #
  
  NHDHR_Illinois_sf:
    command: fetch_NHD_as_sf(url = I('ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Hydrography/NHD/State/HighResolution/GDB/NHD_H_Illinois_State_GDB.zip'))

  NHDHR_Illinois_filtered_sf:
    command: filter_sf_lakes(NHDHR_Illinois_sf, min_size = 40000)

  # --- Wisconsin --- #
  
  NHDHR_Wisconsin_sf:
    command: fetch_NHD_as_sf(url = I('ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Hydrography/NHD/State/HighResolution/GDB/NHD_H_Wisconsin_State_GDB.zip'))

  NHDHR_Wisconsin_filtered_sf:
    command: filter_sf_lakes(NHDHR_Wisconsin_sf, min_size = 40000)

  # --- Minnesota --- #
  
  NHDHR_Minnesota_sf:
    command: fetch_NHD_as_sf(url = I('ftp://rockyftp.cr.usgs.gov/vdelivery/Datasets/Staged/Hydrography/NHD/State/HighResolution/GDB/NHD_H_Minnesota_State_GDB.zip'))

  NHDHR_Minnesota_filtered_sf:
    command: filter_sf_lakes(NHDHR_Minnesota_sf, min_size = 40000)

  # --- Overall job --- #

  canonical_lakes_sf.rds.ind_promise:
    command: combine_nhd_sfs(I('1_crosswalk_fetch/out/canonical_lakes_sf.rds.ind'),
      NHDHR_North_Dakota_filtered_sf,
      NHDHR_South_Dakota_filtered_sf,
      NHDHR_Iowa_filtered_sf,
      NHDHR_Michigan_filtered_sf,
      NHDHR_Indiana_filtered_sf,
      NHDHR_Illinois_filtered_sf,
      NHDHR_Wisconsin_filtered_sf,
      NHDHR_Minnesota_filtered_sf)
    
  gnisname_nhdhr_xwalk.rds.ind_promise:
    command: GNIS_Name_xwalk(I('2_crosswalk_munge/out/gnisname_nhdhr_xwalk.rds.ind'),
      NHDHR_North_Dakota_filtered_sf,
      NHDHR_South_Dakota_filtered_sf,
      NHDHR_Iowa_filtered_sf,
      NHDHR_Michigan_filtered_sf,
      NHDHR_Indiana_filtered_sf,
      NHDHR_Illinois_filtered_sf,
      NHDHR_Wisconsin_filtered_sf,
      NHDHR_Minnesota_filtered_sf)
    
