target_default: 3_predictions

packages:
  - RcppCNPy
  - dplyr
  - feather
  - lubridate

sources:
  - 3_predictions/src/munge_predictions.R

targets:
  3_predictions:
    depends:
     - 3_predictions/out/compare_predictions_obs.feather.ind
     - 3_predictions/out/model_evaluation.csv

  # pull out predictions from SNTEMP in/out - updated in April 2020
  # to use drivers that run through 2019
  3_predictions/out/uncal_sntemp_preds.csv.ind:
    command: pull_sntemp_preds(
      sntemp_ind = '3_predictions/in/uncal_sntemp_input_output.feather.ind',
      out_ind = target_name)

  3_predictions/out/rgcn_v1_preds.feather.ind:
    command: munge_rgcn_output(in_ind = '3_predictions/in/rgcn_v1_preds_raw.npy.ind', out_ind = target_name)

  # put it all together!
  3_predictions/out/compare_predictions_obs.feather.ind:
    command: combine_preds_obs(
      obs_ind = '2_observations/out/obs_temp_drb.rds.ind',
      sntemp_ind = '3_predictions/out/uncal_sntemp_preds.csv.ind',
      rgcn_v1_ind = '3_predictions/out/rgcn_v1_preds.feather.ind',
      rgcn_v2_ind = '3_predictions/in/rgcn_v2_preds.feather.ind',
      rgcn_v2_full_ind = '3_predictions/in/rgcn_v2_preds_full.feather.ind',
      out_ind = target_name)

  # write some model comparisons/stats and git commit for each comparison
  3_predictions/out/model_evaluation.csv:
    command: calc_metrics(compare_ind = '3_predictions/out/compare_predictions_obs.feather.ind', out_file = target_name)
